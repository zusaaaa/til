# AWS S3 IAM

## 概要

- セクション[7] [基礎編]サーバー台数を増やして可用性を高めよう

## 学んだこと

### [S3]

- Amazon S3
  - オブジェクトストレージのサービス
    - データをオブジェクトとして扱う
  - 容量無制限
    - 1ファイル最大5TBまで
  - 高い耐久性
    - 99.99999%
  - ユースケース
    - データバックアップ
    - データ解析用の保管場所
  - バケット
    - オブジェクトの保管場所
  - オブジェクト
    - バケットに保管されるデータ本体
    - 「バケット名 + キー名 + バージョンID」のURLで管理
    - このURLをもとにファイルにアクセスできる
  - メタデータ
    - オブジェクトを管理するための情報
  - ストレージクラス
    - いろんなクラスを指定してデータを保存できる
    - クラスによって向き不向きがある
  - バケットポリシー
    - S3バケットごとにアクセス権を設定できる
  - ACL
    - **S3バケット単位**や**オブジェクト単位** で **簡易的に**権限を設定できる
  - ブロックパブリックアクセス
    - バケット単位、オブジェクト単位で意図せず外部公開できないようにする設定
    - これのおかげで初期設定だと基本的に外部公開されることはない

### [IAM]

- IAM
  - AWS操作をセキュアに行うための認証認可の仕組み
- IAM ユーザー
  - AWSの利用者やアプリケーションがAWSの操作に使用
  - **必ずしもユーザーにのみ適用されるわけではない**
  - 認証方式
    - ユーザー名、パスワード
    - アクセスキー
  - MFA認証が推奨されている
- IAMグループ
  - IAMユーザーをまとめるグループ
  - グループ単位で権限付与できる
- IAMポリシー
  - AWSアクセスに対する権限設定

  ```json
  {
    "Effect": "Allow", # 許可ならAllow、拒否ならDeny
    "Action": [ # 対象となるAWS操作
      "s3:ListBuckets",
      "s3:Get"
    ],
    "Resource": [ #対象となるAWSリソース
      "arn:aws:s3:::myBucket"
    ],
    "Condition": { # このアクセス制御が有効となる条件設定
      "IpAddress": {
        "aws:SourceIP": [
          "198.51.100.1/32"
        ]
      }
    }
  }
  ```

  - 管理ポリシー

    |分類|詳細|
    |--|--|
    |管理ポリシー|IAMユーザー、IAMグループなどにアタッチして使うポリシー(使い回しOK)|
    |AWS管理ポリシー|AWSが管理|
    |カスタム管理ポリシー|利用者が作成|
    |インラインポリシー|IAMユーザー、IAMグループなどに埋め込んで使うポリシー(使い回しNG)|

  - 権限の優先順位
    - デフォルトで全てを拒否(暗黙的な拒否)
    - 明示的な拒否 > 明示的な否定 > 暗黙的な拒否

  - ポリシーA(S3に対する全権限を許可)

  ```json
  {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Allow",
        "Action": "s3:*",
        "Resource": "*"
      }
    ]
  }
  ```

  - ポリシーB(バケットの削除を拒否)

  ```json
  {
    "Version": "2012-10-17",
    "Statement": [
      {
        "Effect": "Deny",
        "Action": "s3:DeleteBucket",
        "Resource": "*"
      }
    ]
  }
  ```

  - この場合
    - S3バケットの作成、ファイルアップロード等は可能
    - S3バケットの削除は不可（拒否が優先）
- IAMロール
  - AWSサービスに対して**一時的な認証情報**をを付与
  - 帽子を被せるだけなので、すぐ外せ


## 重要なポイント

## 現状のアーキテクチャの課題

- 冗長化した上で両方が落ちる可能性がある

## どうやったら改善できるか?

- スケールできる状態にする

## 料金体系

- 

## 質問

## 試験での出題ポイント

- よく出る問題のパターン
- 引っかけやすいポイント

## 参考リンク

- [AWS公式ドキュメント](URL)
- [参考記事](URL)

---
**Date:** 2025-08-21  
**Category:** #aws #saa  
**Service:** #s3 #iam
